!function(){"use strict";function e(e,t,i){var n=[i],r=function(i){var n=e.get("$q"),r=e.get("userService"),a=n.defer();Utilities.isUndefinedOrNull(i)&&(i={}),i.pii=[];var s=Utilities.getManifest();s&&(i.appVersion=s.version);var l=BrowserHandler.i18n.getUILanguage();return Utilities.isNotUndefinedOrNull(l)&&(i.language=l),r.getUserType().then(function(e){return e===t.USER_TYPE.NONE?void a.resolve(i):void r.getUserInfo(e,function(e){return Utilities.isUndefinedOrNull(e)?void a.resolve(i):(Utilities.isNotUndefinedOrNull(e.cid)&&(i.cid=e.cid),Utilities.isNotUndefinedOrNull(e.features)&&(i.experimentFeatures=e.features),Utilities.isNotUndefinedOrNull(e.puid)&&i.pii.push({type:t.TELEMETRY.PII_TYPE.IDENTITY,name:"puid",value:e.puid}),void a.resolve(i))})}),a.promise},a=function(){var t=e.get("$q"),i=e.get("storage"),n=t.defer();return i.get("telemetry_enabled").then(function(e){n.resolve(!(!Utilities.isUndefinedOrNull(e)&&!Utilities.isUndefinedOrNull(e.telemetry_enabled)&&e.telemetry_enabled!==!0))}),n.promise},s=function(t){var i=e.get("storage");i.set({telemetry_enabled:t})},l={getEnabledSetting:function(){return a()},setEnabledSetting:function(e){if(!Utilities.isBackgroundContext())return void BrowserHandler.runtime.sendMessage({activity:t.ACTIVITY.TELEMETRY.NAME,command:t.TELEMETRY.COMMAND.SET_DISABLED,enabled:e});s(e);for(var i=0;i<n.length;++i)n[i].setEnabledSetting(e)},trackEvent:function(e,i,a){if(!angular.isUndefined(e)&&angular.isString(e))return Utilities.isBackgroundContext()?void r(i).then(function(t){for(var i=0;i<n.length;++i){var r=angular.extend({},t);n[i].trackEvent(e,r,a)}}):void BrowserHandler.runtime.sendMessage({activity:t.ACTIVITY.TELEMETRY.NAME,command:t.TELEMETRY.COMMAND.TRACK_EVENT,eventName:e,properties:i,measurements:a})},trackTrace:function(e,i){if(!angular.isUndefined(e)&&angular.isString(e))return Utilities.isBackgroundContext()?void r(i).then(function(t){for(var i=0;i<n.length;++i){var r=angular.extend({},t);n[i].trackTrace(e,r)}}):void BrowserHandler.runtime.sendMessage({activity:t.ACTIVITY.TELEMETRY.NAME,command:t.TELEMETRY.COMMAND.TRACK_TRACE,message:e,properties:i})}};return l}angular.module("app.diagnostics",[]).service("telemetry",["$injector","constants","ariaTelemetry",e])}();